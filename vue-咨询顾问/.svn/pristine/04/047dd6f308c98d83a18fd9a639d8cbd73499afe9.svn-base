<template>
  <div class="Home">
    <Head-Top head-title='申请成为顾问' go-back='true'></Head-Top>
    <div class="login">
      <mt-field label="公司名称" placeholder="公司名称" type="text" v-model="fullName"></mt-field>
      <mt-field label="联系人" placeholder="联系人" type="text" v-model="staffName"></mt-field>
      <mt-field label="联系电话" placeholder="联系电话" type="text" v-model="phone"></mt-field>
      <mt-button type="primary" size="large" class="login-btn" @click.native="submit">申请</mt-button>
    </div>
  </div>
</template>

<script>
import { mapState, mapMutations, mapGetters  } from 'vuex'
import { validatePhone, validateEmail  } from '../../../config/mUtils'
import  { Toast } from "mint-ui"
import HeadTop from '@/components/header/head'
import HomeFooter from '@/pages/footer'
import { isAccountExists, registerGetcheckNum, registerWithMNC } from '@/service/getData'

export default {
  name: "Register",
  data () {
    return{
      fullName: '',
      staffName: '',
      phone: '',
    }
  },
  components: {
    HomeFooter,
    HeadTop
  },
  mounted: function () {

  },
  computed: {
    ...mapState(['loading'])
  },
  methods:{
    ...mapMutations(['SET_LOADING']),

    async handleClick (e) {
      const that = this

      if (!validatePhone(this.mobile)) {
        Toast('请输入正确的手机号码')
        return
      }
      that.SET_LOADING(true)
      let res = await isAccountExists(this.mobile)
      if (res.success) {
        await registerGetcheckNum(this.mobile)
      } else {
        Toast(res.message)
      }

     
      that.SET_LOADING(false)
    },

    async submit (e) {
      const that = this
      if (!validatePhone(this.mobile)) {
        Toast('请输入正确的手机号码')
        return
      }
      if (!this.checknum) {
        Toast('请输入收到的验证码')
        return
      }
      if (this.confirmPassword !== this.password) {
        Toast('两次密码输入不一致')
        return
      }

      that.SET_LOADING(true)
      let regRes = await registerWithMNC({
        mobile: this.mobile,
        password: this.password,
        checknum: this.checknum,
      }).then( response => {
        if (response.success) {
          Toast('注册成功')
          this.$router.go(-1)
        } else {
          Toast(response.message)
        }
        that.SET_LOADING(false)
      })
    }
  }
}
</script>

<style lang="scss" scoped>
  .login {
    margin-top: .1rem;
    .login-btn {
      position: fixed;
      bottom: .2rem;
      width: 95%;
      left: 2.5%;
    }
  }
</style>

