<wxs src = "../../../../utils/wxs.wxs" module = "wxs" />

<loading hidden="{{!showLoading}}">正在加载</loading>
<view>
  <view 
    class='inquery_cont'
    data-id='{{inquiryDetails.providerId}}'
    bindtap="goBusinessDetail"
  >
    <view class='imgLogo'>
      <image src='{{inquiryDetails.providerLogo}}'></image>
    </view>
    <view class='detailsE'>
      <view class='inquery_item pl28'>
        <text class='inquery_name'>{{inquiryDetails.providerName}}</text>
      </view>
      <view class='inquery_item pl28'>
        <text class='inquery_title'>地区</text>
        <v-city 
          code='{{inquiryDetails.area}}' 
          className='inquiry_sn'></v-city>
        <!-- <text class='inquiry_sn'>{{inquiryDetails.area}}</text> -->
      </view>
      <view class='inquery_item pl28'>
        <text class='inquery_title'>类型</text>
        <text class='inquiry_sn'>{{inquiryDetails.providerType=='MTS' ? '修理厂':'配件商'}}</text>
      </view>
    </view>
  </view>

  <!-- 适用机型 -->
  <view class='applicableModel'>
    <text class='typeTitle'>适用机型：</text>
    <text class='typeName'>{{inquiryDetails.prodModelName}}</text>
  </view>
  <!-- 上传的配件图片展示 bindtap="preImg" -->
  <view class='photoView'>
    <image
      wx:for='{{wxs.splitToArr(inquiryDetails.prodImages)}}'
      src="{{item}}" 
      bindtap="preImg"
      mode="aspectFill"
      wx:key='{{index}}'
      data-index="{{index}}"
      data-text="{{item}}"
    ></image>
    <!-- <image 
      src="{{inquiryDetails.prodImages}}" 
      mode="aspectFill" 
      data-text="{{inquiryDetails.prodImages}}" -->
    <!-- ></image> -->
  </view>

  <view wx:if='{{type == 2}}' class='viewBox'>
    <!-- 商品规格 -->
    <view 
      wx:for="{{inquiryDetailsItem}}" 
      wx:key="{{index}}"
      class='viewBoxChild'
    >
      <!-- 头部信息 -->
      <view class='tabelHead'>
        <view class='searialNum' style='flex:none'>{{index + 1}}</view>
        <view style='flex:1'>
          <text class='name'>{{item.prodName}}</text>
        </view>
        <view class='f14'>x {{item.prodNum}}</view>
      </view>
      <!-- 表格 -->
      <view class="table mb20 xunjia1">
        <view class="tr">
          <view class="th flex1">等级</view>
          <view class="th flex2">价格(单价)</view>
          <view class="th flex3">备注</view>
        </view>
        <view 
          class="tr {{inquiryDetailsItem[0].offers[itemIndex].offerState==1?'selected':''}}" 
          wx:for="{{wxs.splitToArr(inquiryDetails.groupLimit)}}" 
          wx:key="{{itemIndex}}" 
          wx:for-index="itemIndex" 
          wx:for-item="itemItems" 
        >
          <view class="td flex1">
            {{itemItems}}
          </view>
          <view class="td flex2">
            <view class='frc'>
              <text 
                class='noprice' 
                wx:if='{{(inquiryDetails.state == 1 && inquiryDetailsItem.length>0 && inquiryDetailsItem[0].offers.length>0) || inquiryDetails.state == 2 || inquiryDetails.state == 3}}'
              >{{inquiryDetailsItem[index].offers[itemIndex].price ? inquiryDetailsItem[index].offers[itemIndex].price + ' 元':'--'}}</text>
              <input
                wx:else
                class='inp_price'
                type='digit'
                data-pIndex='{{index}}'
                data-name='price'
                data-iIndex='{{itemIndex}}'
                bindblur='setOffer'
              ></input>
            </view>
          </view>
          <view class="td flex3">
            <text 
              class='noprice' 
              wx:if='{{(inquiryDetails.state == 1 && inquiryDetailsItem.length>0 && inquiryDetailsItem[0].offers.length>0) || inquiryDetails.state == 2 || inquiryDetails.state == 3}}'
            >{{inquiryDetailsItem[index].offers[itemIndex].remark || '--'}}</text>
            <input
              wx:else
              placeholder='填写备注'
              data-name='remark'
              data-pIndex='{{index}}'
              data-iIndex='{{itemIndex}}'
              bindblur='setOffer' 
            ></input>
          </view>
        </view>
      </view>
    </view>

    <!-- 表格信息结束 -->
    <button 
      class='sava'
      wx:if='{{inquiryDetails.state == 1 && inquiryDetailsItem.length>0 && inquiryDetailsItem[0].offers.length==0}}'
      bindtap='submit'
    >
      提交报价
    </button>
    <button 
      class='close'
      wx:if='{{inquiryDetails.state == 2}}'
    >
      报价关闭
    </button>
    <!-- <button 
      class='close'
      wx:if='{{inquiryDetails.state == 1 && inquiryDetailsItem.length>0 && inquiryDetailsItem[0].offers.length>0}}'
    >
      您已提交报价
    </button> -->
    <button 
      class='close' 
      wx:if='{{inquiryDetails.state == 3 && (!dealWithMe)}}'>已完成</button>
    <view 
      class='pf_footer'
      wx:if='{{inquiryDetails.state == 3 && dealWithMe}}'
    >
      <view class='frc'>
        <view>
          共 <text style='color:#F05B29'>{{inquiryDetails.countDown}}</text> 件 合计：￥
            <text style='color:#F05B29'>{{inquiryDetails.price}}</text>
        </view>
      </view>
      <view 
        class='submit havaOffer'
        data-phone='{{inquiryDetails.mobile}}'
        bindtap='mackePhone'>联系商家</view>
    </view>
  </view>
  <view wx:else>
    <!-- 发布询价-审核 -->
    <view 
      class='examine' 
      wx:if="{{inquiryDetails.state == 0 && inquiryDetailsItemOffer.length <= 0}}">
      <view class='text'>
          <!-- 您的订单已经提交到掌窝后台 客服人员急速审核中 -->
          提交成功，客服火速审核中 
      </view>
      <image src='/images/inquiry/loading.gif' class='loading'></image>
    </view>

      <!-- 发布询价-报价中 -->
    <view 
      class='examine' 
      wx:if="{{inquiryDetails.state == 1 && inquiryDetailsItemOffer.length <= 0}}">
      <view class='text'>
          <!-- 您的订单已经提交到掌窝后台 客服人员急速审核中 -->
          <view>一大波配件商已经收到您的订单</view>
          <view>正在火速报价中</view>
      </view>
      <image src='/images/inquiry/loading.gif' class='loading'></image>
    </view>
    <block
      wx:if='{{inquiryDetailsItemOffer.length}}'
      wx:key="{{index}}" 
      wx:for="{{inquiryDetailsItemOffer}}"
    >
      <!-- 报价公司 -->
      <view class='quotationCompany'>
          <view 
            class='df'
            data-id='{{item.providerId}}'
            bindtap="goBusinessDetail">
              <image 
                src='{{item.providerLogo}}' 
                class='comp_logo'></image>
              <view class='compCont'>
                <view class='comp_name'>{{item.providerName}}</view>
                <view>
                  <!-- <text class='label'>中国</text> -->
                  <v-city 
                    code='{{item.providerArea}}' 
                    className='inquiry_sn'>
                  </v-city>
                  <text class='label'>已报价{{item.offerCount || 0}}单</text>  
                </view>                  
              </view>
          </view>
          <view 
            class='phoneInfo' 
            data-phone="{{item.phone}}" 
            bindtap='mackePhone' 
            data-id="{{item.authen_id}}">
              <image 
                src='/images/inquiry/phone@2x.png'  
                style='width:32rpx;height:32rpx'></image>
              <text 
                style='color:#3283E4;font-size:20rpx;margin-top:4rpx'>电话</text>
            </view>
      </view>

      <view class=' wraper '>
        <view class='innerWraper' >
          <!--表格信息 - 商品规格 -->
          <view 
            wx:for="{{item.offerItemVoList}}" 
            wx:for-item="offer" 
            wx:for-index="offerIndex" 
            wx:key="{{index}}">
              <!-- 头部信息 -->
              <view class='tabelHead'>
                  <view>
                      <text class='searialNum'>{{offerIndex + 1}}</text>
                      <text class='name'>{{offer.prodName}}</text>
                  </view>
                  <view class='f14'>x {{offer.prodNum}}</view>
              </view>
              <!-- 备注 -->
              <view 
                class='tableRemarks' 
                wx:if="{{offer.remark}}">备注：{{offer.parts_remarks}}</view>
              <!-- 表格 -->
              <view class="table mb20" style='border-left:0'>
                  <view class="tr">
                      <view class="th flex1">等级</view>
                      <view class="th flex1">价格(单价)</view>
                      <view class="th flex1">备注</view>
                      <view class="th flex1">选择</view>
                  </view>
                  <view 
                    class="tr" 
                    wx:for="{{offer.groupList}}" 
                    wx:for-item="qualityItem" 
                    wx:for-index="qualityIndex" 
                    wx:key="qualityIndex">
                      <view 
                        class="td flex1">{{qualityItem.groupName}}</view>
                      <view class="td flex1">
                      {{qualityItem.price?qualityItem.price+'元':'- -'}}
                      </view>
                      <view class="td flex1">
                      {{qualityItem.remark?qualityItem.remark:'- -'}}
                      </view>
                      <view 
                        class="td flex1"
                        data-item='{{qualityItem}}'
                        data-index="{{index}}"
                        data-itemId='{{offer.itemId}}'
                        data-reqItemId='{{qualityItem.reqItemId}}'
                        data-offerIndex="{{offerIndex}}" 
                        data-qualityIndex="{{qualityIndex}}" 
                        bindtap='choice_quality' 
                      >
                          <view wx:if='{{inquiryDetails.state == 1}}'>
                            <checkbox
                              wx:if='{{qualityItem.price}}'
                              checked="{{!qualityItem.selected?false:true}}"
                              class='checkBtn' 
                            />
                          </view>
                          <view wx:if='{{qualityItem.state == 1}}'>
                            <image
                            src='/images/inquiry/sucess.jpg' 
                            style='width:15px;height:15px'></image>
                          </view>
                      </view>
                  </view>
              </view>
          </view>
        </view>

       <view wx:if='{{inquiryDetails.state == 1}}'>
          <view 
            class='pf_footer'
            wx:if='{{!selectedNum}}'
          >
            <view class='frc'>
                <image 
                src='/images/inquiry/time@2x.png' 
                class='time'></image>
                <view>{{inquiryDetails.expireDate}}前报价有效</view>
            </view>
            <view class='submit'>选择成交</view>
          </view>
          <view 
            class='pf_footer'
            wx:else
          >
          <view class='frc'>
            <view>
              共 <text style='color:#F05B29'>{{selectedNum}}</text> 件 合计：￥
                <text style='color:#F05B29'>{{totalPrice}}</text>
            </view>
            </view>
            <view 
              class='submit havaOffer' 
              bindtap='choiceOffer'>选择成交</view>
          </view>
       </view>
        <!-- 选择成交有价格 -->
        <view 
          class='pf_footer'
          wx:if='{{inquiryDetails.state == 3}}
        >
            <view class='frc'>
              <view>
                共 <text style='color:#F05B29'>{{inquiryDetails.countDown}}</text> 件 合计：￥
                  <text style='color:#F05B29'>{{inquiryDetails.price}}</text>
              </view>
            </view>
        </view>
      </view>
    </block>
    <view wx:if="{{!from}}">
      <v-modal bind:click='click' show='{{show}}'></v-modal>
    </view>
  </view>
</view>