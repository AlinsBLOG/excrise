const util = require('../../utils/util.js');
const api = require('../../utils/api.js');
const App = getApp();
Page({
  data: {

  },
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function(options) {
    
  },
  onShow(){
    const userInfo = util.getStorageSync('userInfo');
    const registerInfo = util.getStorageSync('registerInfo');
    if (!userInfo) {
      wx.showModal({
        content: '您还没有登陆',
        success:function(e){
          if(e.confirm){
            wx.navigateTo({
              url: '/pages/login/login',
            })
          } else {
            wx.switchTab({
              url: '/pages/index/inqueryRoom/inqueryRoom'
            })
          }
        }
      })
    } else {
      var pages = getCurrentPages(); // 当前页面

      util.request(api.userProvider, {
        userId: userInfo.userId,
        tenantId: App.globalData.tenantId
      }, 'GET').then(res => {
        console.log(res)
        if (res.success) {
          if (res.data && (typeof res.data) === 'object') {
            if (res.data && res.data.apply) {
              wx.navigateTo({
                url: `/pages/index/inqueryRoom/inqueryOrderDetail/businessAuth/authForm/examine/examine`,
              })
            } else {
              wx.navigateTo({
                url: `/pages/index/makeInquriy/makeInquriy`
              })
            }
          } else {
            wx.navigateTo({
              url: '/pages/index/inqueryRoom/inqueryOrderDetail/businessAuth/businessAuth'
            })
          }
        }
      })

      if (pages[0].route == 'pages/inqueryTab/inqueryTab'){
        wx.switchTab({
          url: '/pages/index/inqueryRoom/inqueryRoom'
        })
      } else {
        wx.navigateTo({
          url: '/pages/index/makeInquriy/makeInquriy'
        })
      }
    }
  }
})